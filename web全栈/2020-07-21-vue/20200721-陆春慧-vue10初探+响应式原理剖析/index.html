<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>vue3初探+响应式原理</title>
    <script src="./vue.global.js"></script>
</head>

<body>
    <div id="app">
        <h1>see you next time</h1>
        <input v-model="todo" @keyup.enter="onEnter" />
        <h2>进行中（{{ doingLength }}）</h2>
        <ul>
            <template v-for="(item, index) in todoList" >
                <li :key="index" v-if="item.done === false">
                    <label>
                        <input type="checkbox" @change="changeTodo(index,true)">
                        {{item.todo}}
                    </label>                    
                </li>
            </template>
            
        </ul>
        <h2>已完成（{{ finishedLength }}）</h2>
        <ul>
            <template v-for="(item, index) in todoList">
                <li :key="index" v-if="item.done === true">
                    <label>
                        <input type="checkbox" checked='checked' @change="changeTodo(index,false)">
                        {{item.todo}}
                    </label>  
                </li>
            </template>
        </ul>
    </div>
    <script>
        const { createApp, reactive, computed, toRefs } = Vue

        const app = createApp({
            setup() {
                const data = reactive({
                    todo: "",
                    todoList: [],
                    doingLength: computed(() => {
                        let count = 0;
                        data.todoList.forEach(element => {
                            if (!element.done) {
                                count++;
                            }
                        });
                        return count;
                    }),
                    finishedLength: computed(() => data.todoList.length - data.doingLength)
                })

                function onEnter() {
                    data.todoList.push({
                        done: false,
                        todo: data.todo
                    });
                    data.todo = "";
                }

                function changeTodo(index, done) {
                    data.todoList[index].done = done;
                }

                return {
                    ...toRefs(data),
                    onEnter,
                    changeTodo
                }
            }
        }).mount("#app");
    </script>
</body>

</html>